# 1正则表达式

## 1.1基础实践

### 1.1.1基础知识

- 表达式分类

  ```
  基本正则表达式：
  	BRE Basic Regular Expressions
  	- 借助于基本的属性信息实现内容的精准匹配
  扩展正则表达式：
  	ERE Extended Regular Expressions
  	- 借助于扩展符号的能力，实现更大范围的信息匹配
  ```

- 通配符和正则

  ```
  正则表达式用来在文件中匹配符合条件的字符串，主要是目的是包含匹配。
  	- grep、awk、sed 等命令可以支持正则表达式。
  通配符用来匹配符合条件的文件名，通配符是完全匹配。
   	- ls、find、cp 之类命令不支持正则表达式，可以借助于shell通配符来进行匹配。
   		.：匹配任意一个字符
          *：匹配任意内容
          ?：匹配任意一个内容
         []：匹配中括号中的一个字符
  ```

  

### 1.1.2字符匹配

- 单字符匹配

  ```
  .   	匹配任意单个字符，当然包括汉字的匹配
  []  	匹配指定范围内的任意单个字符
  		- 示例：[shuji]、[0-9]、[a-z]、[a-zA-Z]
  [^] 	匹配指定范围外的任意单个字符
  		- 示例：[^shuji] 
  |  		匹配管道符左侧或者右侧的内容
  ```

  

### 1.1.3锚定匹配

所谓的锚定匹配，主要是在字符匹配的前提下，增加了字符位置的匹配

```
常见符号
    ^ 				#行首锚定, 用于模式的最左侧
    $ 				#行尾锚定，用于模式的最右侧
    ^PATTERN$ 		#用于模式匹配整行
    ^$ 				#空行
    ^[[:space:]]*$ 	#空白行
    \< 或 \b     	#词首锚定，用于单词模式的左侧
    \> 或 \b    		#词尾锚定，用于单词模式的右侧
    \<PATTERN\>		#匹配整个单词
注意:
	单词是由字母,数字,下划线组成
```

### 1.1.4分组符号

```
所谓的分组，其实指的是将我们正则匹配到的内容放到一个()里面
	- 每一个匹配的内容都会在一个独立的()范围中
	- 按照匹配的先后顺序，为每个()划分编号
	- 第一个()里的内容，用 \1代替，第二个()里的内容，用\2代替，依次类推
	- \0 代表正则表达式匹配到的所有内容
注意：
	() 范围中支持|等字符匹配内容。从而匹配更多范围的信息
	关于()信息的分组提取依赖于文件的编辑工具，我们可以借助于 sed、awk功能来实现
	提示: sed -r 's/原内容/修改后内容/'
示例:
	(M|m)any 可以标识 Many 或者 many
```

```
root@rocky9:~ $ cat zoo.cfg 
tickTime=2000
initLimit=10
syncLimit=5
dataDir=/data/server/zookeeper/data
dataLogDir=/data/server/zookeeper/logs
clientPort=2181
server.1=10.0.0.12:2182:2183
server.2=10.0.0.13:2182:2183
server.3=10.0.0.14:2182:2183:observer
4lw.commands.whitelist=stat, ruok, conf, isro
#获取zookeeper的集群相关信息
[root@rocky9 ~]# egrep '(server.[0-9])' zoo.cfg
server.1=10.0.0.12:2182:2183
server.2=10.0.0.13:2182:2183
server.3=10.0.0.14:2182:2183:observer
[root@rocky9 ~]# egrep '(init|sync)Limit' zoo.cfg
initLimit=10
syncLimit=5
#借助于sed的编辑文件功能，实现特定信息的提取
[root@rocky9 ~]# grep server.1 zoo.cfg | sed -r "s/(.*)=(.*):(.*):(.*)/\1/"
server.1
[root@rocky9 ~]# grep server.1 zoo.cfg | sed -r "s/(.*)=(.*):(.*):(.*)/\2/"
10.0.0.12
[root@rocky9 ~]# grep server.1 zoo.cfg | sed -r "s/(.*)=(.*):(.*):(.*)/\3/"
2182
[root@rocky9 ~]# grep server.1 zoo.cfg | sed -r "s/(.*)=(.*):(.*):(.*)/\4/"
2183
解读：
	sed 的 -r 选项指的是，后面的匹配是扩展正则的内容。
```

## 1.2进阶知识

### 1.2.1限定符号

```
常见符号
	* 		#匹配前面的字符任意次，包括0次，贪婪模式：尽可能长的匹配
	.* 		#任意长度的任意字符
	? 		#匹配其前面的字符出现0次或1次,即:可有可无
	+ 		#匹配其前面的字符出现最少1次,即:肯定有且 >=1 次
	{m} 	#匹配前面的字符m次
	{m,n} 	#匹配前面的字符至少m次，至多n次
	{,n}   	#匹配前面的字符至多n次,<=n
	{n,}   	#匹配前面的字符至少n次
```

### 1.2.2扩展符号

```
字母模式匹配
    [:alnum:] 字母和数字
    [:alpha:] 代表任何英文大小写字符，亦即 A-Z, a-z
    [:lower:] 小写字母,示例:[[:lower:]],相当于[a-z]
    [:upper:] 大写字母
数字模式匹配
    [:digit:] 十进制数字
    [:xdigit:]十六进制数字
符号模式匹配
    [:blank:] 空白字符（空格和制表符）
    [:space:] 包括空格、制表符(水平和垂直)、换行符、回车符等各种类型的空白
    [:cntrl:] 不可打印的控制字符（退格、删除、警铃...）
    [:graph:] 可打印的非空白字符
    [:print:] 可打印字符
    [:punct:] 标点符号
    
注意
	在使用该模式匹配的时候，一般用[[ ]]，
 	- 第一个中括号是匹配符[] 匹配中括号中的任意一个字符
 	- 第二个[]是格式 如[:digit:]

属性模式匹配
	\s 匹配任何空白字符，包括空格、制表符、换页符等等。等价于 [\f\r\t\v]
	\S 匹配任何非空白字符。等价于 [^\f\r\t\v]
    \w 匹配一个字母,数字,下划线,汉字,其它国家文字的字符，等价于[_[:alnum:]字]
    \W 匹配一个非字母,数字,下划线,汉字,其它国家文字的字符，等价于[^_[:alnum:]字]
```

匹配IP地址

```
^((1?[0-9][0-9]?|2[0-4][0-9]|25[0-5])\.){3}(1?[0-9][0-9]?|2[0-4][0-9]|25[0-5])$
```

匹配邮箱

```
^[0-z_]+\@[0-z]+\.[0-z]{2-5}$
```

# 2文件查找

## 2.1locate命令

```
非实时查找
	- 索引的构建是在系统较为空闲时自动进行(周期任务)，执行updatedb可以更新数据库
	- 查找速度快
 		locate 查询系统上预建的文件索引数据库 /var/lib/mlocate/mlocate.db
	- 模糊查找
	- 搜索的是文件全路径，不仅仅是文件名
		索引构建过程需要遍历整个根文件系统，很消耗资源
	- 可能只搜索用户具备读取和执行权限的目录
```

```
格式
	locate 选项 文件路径
选项
	-i：忽略大小写地匹配模式。例如，locate -i myfile会同时匹配"myfile"、"MyFile"等。
    -c：只显示匹配项的数量（count），而不是文件名。
    -l NUM：限制输出的行数，每行显示一个匹配项。
    -n NUM：限制输出的匹配项数目，只显示前NUM个结果。
    -r：使用正则表达式模式匹配。例如，locate --regex '.*\.txt$'会匹配所有以".txt"结尾的文件。
    -b：只匹配基准名，忽略路径。
    -w：仅匹配完整单词。
```

```
-A|--all             #输出所有能匹配到的文件名，不管文件是否存在
-b|--basename         #仅匹配文件名部份，而不匹配路径中的内容
-c|--count             #只输出找到的数量
-d｜--database DBPATH   #指定数据库
-e|--existing         #仅打印当前现有文件的条目
-L|--follow         #遇到软链接时则跟随软链接去其对应的目标文件中查找 (默认)
-i|--ignore-case       #忽略大小写
-l|--limit|-n N #只显示前N条匹配数据
-P|--nofollow, -H     #不跟随软链
-r|--regexp REGEXP     #使用基本正则表达式
--regex           #使用扩展正则表达式
-s|--stdio             #忽略向后兼容
-w|--wholename         #全路径匹配，就是只要在路径里面出现关键字（默认）
```

```
Rocky系统
 yum install -y mlocate
ubuntu系统
 apt install -y Plocate
 
 更新数据库
 updatedb
```

## 2.2find命令

```
- 查找速度略慢
- 精确查找
- 实时查找
- 查找条件丰富
- 只搜索用户具备读取和执行权限的目录
```

```
命令格式：
 find [搜索路径] [选项] [表达式]
 	搜索路径：指定find命令开始搜索的目录。可以是一个或多个路径。不指定路径，表示当前路径。
 	选项：用于定义搜索的条件，如文件名、文件类型、大小、时间等。
 	表达式：用于进一步细化搜索条件，可以与选项组合使用来构建复杂的搜索逻辑。
```

```
常用选项
    -name：按文件名匹配，区分大小写。支持使用glob，如：*, ?, [], [^],通配符要加双引号引起来
    -type：按文件类型搜索。常用类型包括f（普通文件）、d（目录）、l（符号链接）等。
    -size：按文件大小搜索。单位可以是c（字节）、k（千字节）、M（兆字节）、G（千兆字节）等。例如，-size +10M查找大于10MB的文件。
    -mtime：按天数查找文件最后修改时间。例如，-mtime -7查找最近7天内修改的文件。
     -user：按文件所有者查找。
    -group：按文件所属组查找。
    -perm：按文件权限查找。
    -maxdepth：限制搜索的最大深度。
    -mindepth：限制搜索的最小深度。
 	-regextype type: 正则表达式类型，emacs|posix-awk|posix-basic|posix-egrep|posixextended
 	-regex pattern: 正则表达式
```

```
除了搜索功能外，find命令还可以对搜索结果执行各种操作。常用的操作选项包括：
	-print：打印搜索结果（默认行为）。
	-exec：对每个匹配的文件执行指定的命令。命令以{}代表当前文件，命令结尾以;或+结束。
	-ok：与-exec类似，但在执行每个命令前都会提示用户确认。
	-delete：直接删除匹配的文件或目录（使用时要小心）。
	-ls：以ls -dils的格式显示匹配的文件。
```

## 2.3权限查找

```
-user USERNAME #查找属主为指定用户(UID)的文件
-group GRPNAME #查找属组为指定组(GID)的文件
-uid UserID #查找属主为指定的UID号的文件
-gid GroupID #查找属组为指定的GID号的文件
-nouser #查找没有属主的文件
-nogroup #查找没有属组的文件
```

```
-perm [/|-]MODE

MODE #精确权限匹配
/MODE #任何一类(u,g,o)对象的权限中只要有一位匹配即可，表示或者(or)关系
+MODE #从CentOS 7开始己淘汰
-MODE #每一类对象都必须同时拥有指定权限，表示与(and)关系
注意：
	0 如果要找时权限位上的值为0，则表示不关注该角色权限
```

## 2.4类型查找

```
	-empty #空文件或空目录
	-prune #跳过，排除指定目录,必须配合 -path使用
	-type TYPE #指定文件类型   *****
type 值
    f #普通文件
    d #目录文件
    l #符号链接文件
    s #套接字文件
    b #块设备文件
    c #字符设备文件
    p #管道文件
```

## 2.5组合查找

```
-a #与，多条件默认就是与关系，可省略
-o #或
-not|！ #非
```

```
除了搜索功能外，find命令还可以对搜索结果执行各种操作。常用的操作选项包括：
-print：打印搜索结果（默认行为）。
-exec：对每个匹配的文件执行指定的命令。命令以{}代表当前文件，命令结尾以;或+结束。
-ok：与-exec类似，但在执行每个命令前都会提示用户确认。
-delete：直接删除匹配的文件或目录（使用时要小心）。
-ls：以ls -dils的格式显示匹配的文件。
```

```
德·摩根定律：
- (非A)且(非B)=非(A或B)
- (非A)或(非B)=非(A且B)

!A -a !B = !(A -o B)
!A -o !B = !(A -a B)
```

```
# !A -a !B
root@ubuntu24:~# find ! -name "f*" -a ! -name "dir*"
.
./.issue
./test-a.log
./test-a.txt
./test-b.log
./test-b.txt
# !(A -O b)
root@ubuntu24:~# find ./ ! \( -name "f*" -o -name "dir*" \)
./
./.issue
./test-a.log
./test-a.txt
./test-b.log
./test-b.txt
# !A -o !B
root@ubuntu24:~# find ! -type f -o ! -empty
.
./dir1
./dir1/dir2
./dir1/dir2/dir3
./dir1/dir2/dir3/dir4
./fstab
./.issue
# !(A -a B)
root@ubuntu24:~# find ! \( -type f -a -empty \)
.
./dir1
./dir1/dir2
./dir1/dir2/dir3
./dir1/dir2/dir3/dir4
./fstab
./.issue
```

## 2.6文件属性查找

```
-size [+|-]N UNIT # N为数字，UNIT为常用单位 k, M, G, c(byte) 等
	#解释
		10k #表示(9k,10k],大于9k 且小于或等于10k
		-10k #表示[0k,9k],大于等于0k 且小于或等于9k
		+10k #表示(10k,∞)，大于10k
```

```
以天为单位
 	-atime [+|-]N -mtime [+|-]N -ctime [+|-]N
以分钟为单位
 	-amin [+|-]N -mmin [+|-]N -cmin [+|-]N
解释
	N #表示[N,N+1),大于或等于N，小于N+1，表示第N天(分钟)
	+N #表示[N+1,∞],大于或等于N+1，表示N+1天之前(包括) 
	-N #表示[0,N),大于或等于0，小于N，表示N天(分钟)内
```

## 2.7动作进阶

```
-print #默认的处理动作，显示至屏幕
-print0 #不换行输出，常用于配合xargs
-ls #类似于对查找到的文件执行"ls -ils"命令格式输出
-fls file #查找到的所有文件的长格式信息保存至指定文件中，相当于 -ls > file
-delete #删除查找到的文件，慎用！
-ok COMMAND {} \; #对查找到的每个文件执行由COMMAND指定的命令，对于每个文件执行命令之
前，都会交互式要求用户确认
-exec COMMAND {} \; #对查找到的每个文件执行由COMMAND指定的命令
{} #用于引用查找到的文件名称自身
```

## 2.8xargs组合

```
xargs [OPTION]... COMMAND [INITIAL-ARGS]...
	[OPTION]：xargs 的选项，用来控制其行为。
	COMMAND：要执行的命令。
	[INITIAL-ARGS]：传递给 COMMAND 的初始参数。
#常用选项
-0|--null 					#用 assic 中的0或 null 作分隔符
-a|--arg-file=FILE         #从文件中读入作为输入
-d|--delimiter=CHARACTER   #指定分隔符
-E END                     #指定结束符，执行到此处时停止，不管后面的数据
-L|--max-lines=N   			#从标准输入一次读取N行送给 command 命令
-l               			#同上
-n|--max-args=MAX-ARGS     #一次执行用几个参数
-p|--interactive           #每次执行前确认
-r|--no-run-if-empty       #当xargs的输入为空的时候则停止xargs，不用再去执行了
-s|--max-chars=MAX-CHARS   #命令行最大字符数
-t|--verbose               #显示过程，先打印要执行的命令
-x|--exit                   #退出，主要配合-s使用
```

## 2.9总结

```
从标准输入里面接受参数
	这些参数以空格为分隔符
|xargs -n1 -I {} rm -f {}
find使用场景
	1、直接根据文件名来查找
	find /dir -name "test*"
	2、删除特定范围的日志文件
	find /log -atime +7 -a -atime -15 -delete
	3、find结合xarge同时使用
	find /log -atime +7 -a -atime -15 | xargs rm -f
```



# 3打包压缩

## 3.1tar

```
tar 即 Tape ARchive 磁带归档，可以对目录和多个文件打包成一个文件进行归档；其本身不具备压缩功能，但可以使用参数调用相应的压缩命令进行压缩；前提是当前系统中有安装该压缩工具此命令可以保留文件属性，推荐使用；对应的文件是 .tar或.tar.gz后缀
```

- tar [OPTION...] [FILE]...
- tar 选项 要打包到的目录 要打包的文件
  - OPTION：`tar` 的选项，用来指定如何打包、压缩或解压。
  - FILE：要打包或解压的文件或目录。

- tar 命令的常见选项 

  - -c       创建一个压缩包

  - -z       tar.gz 类型格式的压缩包

  - -v       显示压缩过程 | 解压过程

  - -x       解压一个压缩包文件

  - -f       指定压缩包文件名

- 解压场景里面还有一个专属的选项

  - -C 	我要解压到那个目录

- 压缩文件

  ```
  tar zcvf target.tar.gz   dir
  tar zcf target.tar.gz   dir
  ```

- 解压到当前目录

  ```
  tar xf target.tar.gz
  ```

- 解压到指定目录/dir下

  ```
  tar xf target.tar.gz -C /dir
  ```

  

## 3.2zip

```
zip 可以实现打包目录和多个文件成一个文件并压缩，但可能会丢失文件属性信息，如：所有者和组信息分别来自于 zip 和 unzip 包对应的文件是 .zip 后缀
```

```
格式
	zip [OPTION]... zipfile [FILE]...
	unzip [OPTION]... zipfile [FILE]...
	OPTION：选项，控制压缩的方式。
	zipfile：要创建的压缩文件名（以 .zip 为后缀）。
	FILE：要压缩的文件或目录。
zip选项
	-f   #更换较新的文件到压缩文件内
	-u   #如果压缩包内有，则更新，如果没有，则追加进去
	-d   #从压缩包内删除指定的文件
	-m   #将文件压缩之后，删除原始文件
	-r   #递归压缩目录      
	-j   #只保存文件名称及其内容，而不存放任何目录名称              
	-l   #压缩文件时，把LF字符置换成LF+CR字符，unzip -l 表示显示压缩文件的内容
	-1   #最快压缩，数字1              
	-9   #最高压缩比，数字9
	-q   #安静模式             
	-v   #显示过程
	-c   #替每个被压缩的文件加上注释
	-z   #给压缩包加注释，unzip -z 查看注释
	-x   #压缩时排除指定文件
	-i   #仅压缩指定文件
	-D   #压缩文件内不建立目录名称
	-T   #测试，检测压缩文件是否完整       
	-X   #不保存额外的文件属性
	-y   #直接保存符号连接，而非该链接所指向的文件
	-n   #不压缩以特定字符串结尾的文件
	-P   #加密码
	-e   #加密压缩文件
unzip选项
	-p   #将压缩内容通过管道传送     
	-l   #显示压缩文件内所包含的文件
 	-t   #测试，检测压缩文件是否完整  
	-z   #查看注释
	-v   #列出包内文件信息
	-x   #指定不需要解压缩的文件
	-d   #指定解压后的目标目录
	-n   #解压缩时不要覆盖原有的文件        
	-q   #安静模式
	-o   #直接覆盖      
	-a   #对文本文件进行必要的字符转换
	-j   #不处理压缩文件中原有的目录路径   
	-C   #压缩文件中的文件名称区分大小写     
	-L   #将压缩文件中的全部文件名改为小写
	-X   #解压缩时同时回存文件原来的UID/GID                   
	-V   #保留VMS的文件版本信息
	-K   #解压缩后还原权限   
	-M   #将输出结果送到more程序处理
	
注意：
    在linux 系统环境里面，很少 使用zip压缩包
    但是 会用到别人的zip包，所有解压命令使用的比较频繁
    默认情况下，解压到，当前目录
-d  /dir  解压文件到 /dir 目录下
```

## 3.3zcat

- ```
  zcat 可以查看 压缩包文件的详细内容
      -l 查看压缩包的基本情况 
      -? 可以直接以列表的方式，查看压缩包里面的 文件
  zcat 选项 文件
  选项
  	-c #将内容输出到标准输出，默认
  	-d #解压缩
  	-l #显示压缩文件(包)内的文件列表
  	-r #在目上递归操作
  	-t #测试压缩文件完整性
  ```

## 3.4split命令

split 命令可以分割一个文件为多个文件

```
split [OPTION]... [FILE [PREFIX]]
OPTION：选项，控制文件分割的行为。
FILE：要分割的源文件。
PREFIX：分割后的文件名前缀（如果不指定，默认是 x）。
选项
	-b|--bytes=SIZE       #按大小指定分割单位
	-C|--line-bytes=SIZE  #同-b，但是在切割时将尽量维持每行的完整性
	-d                  #切割后小文件的后缀用数字表示
	-l|--lines=NUMBER   #指定行数，按多少行切一个小文件
	--verbose     		#显示过程
	-b			按字节分割
	-l			按行数分割
	-n			分割成指定数量的块
```











20250316
